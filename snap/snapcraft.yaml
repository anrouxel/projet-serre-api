name: projet-serre-api
license: GPL-3.0
summary: API de communication entre le serveur et Android
description: |
  API de communication entre le serveur et Android

base: core20
grade: stable
confinement: strict

adopt-info: projet-serre

architectures:
  - build-on: arm64
  - build-on: armhf
  - build-on: amd64

slots:
  gpio-20:
    interface: gpio
    number: 20
  gpio-26:
    interface: gpio
    number: 26
  gpio-27:
    interface: gpio
    number: 27
  gpio-44:
    interface: gpio
    number: 44
  gpio-45:
    interface: gpio
    number: 45
  gpio-46:
    interface: gpio
    number: 46
  gpio-47:
    interface: gpio
    number: 47
  gpio-48:
    interface: gpio
    number: 48
  gpio-49:
    interface: gpio
    number: 49
  gpio-60:
    interface: gpio
    number: 60
  gpio-61:
    interface: gpio
    number: 61
  gpio-65:
    interface: gpio
    number: 65
  gpio-66:
    interface: gpio
    number: 66
  gpio-67:
    interface: gpio
    number: 67
  gpio-68:
    interface: gpio
    number: 68
  gpio-69:
    interface: gpio
    number: 69
  gpio-112:
    interface: gpio
    number: 112
  gpio-115:
    interface: gpio
    number: 115
  gpio-117:
    interface: gpio
    number: 117
  i2c-0:
    interface: i2c
    path: /dev/i2c-0
  i2c-1:
    interface: i2c
    path: /dev/i2c-1

apps:
  projet-serre:
    command: bin/projet-serre-api
    daemon: simple
    restart-condition: always
    plugs: [home, network, network-bind]
  
  projet-serre-serial-link:
    command: bin/rasp-serial
    daemon: simple
    restart-condition: always
    plugs: [home, serial-port]

parts:
  projet-serre:
    plugin: npm
    npm-node-version: "14.16.0"
    source: https://github.com/anrouxel/projet-serre-api.git
    source-type: git
    override-pull: |
      snapcraftctl pull
      snapcraftctl set-version "$(git describe --tags | sed 's/v//' | sed "s/-g/%/"  | cut -d "%" -f1)"
    build-packages:
      - git
      - sed

  projet-serre-serial-link:
    plugin: python
    source: https://github.com/anrouxel/projet-serre-serial-link.git
    source-type: git
    python-packages: [pip, pyserial]